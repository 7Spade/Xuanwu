# Angular 20 + 控制流 + SSR + Less Zero 規範

本文件定義在 Angular 20 專案中，結合新版控制流、SSR 與 Less Zero 架構理念時，**必須遵守的技術邊界、設計原則與實作規範**。此規範用於大型專案、框架遷移（如 Next.js → Angular）與多代理協作場景。

---

## 一、核心目標（Goals）

1. 行為等價優先於實作相似
2. 明確職責邊界，避免隱性耦合
3. SSR 為一等公民，而非事後補強
4. 控制流語法只用於 View 層
5. Less Zero：最少框架魔法、最少隱性狀態

---

## 二、Angular 20 基礎技術邊界

### 2.1 Angular 版本與能力

* Angular 20（standalone 為預設）
* 禁止使用 NgModule
* 預設啟用 Signals
* 啟用新版 Template Control Flow

### 2.2 Template 控制流規範

允許：

* `@if / @else`
* `@for`
* `@switch`

禁止：

* 在 template 中出現業務邏輯判斷
* 在控制流中觸發 side effects

控制流僅負責：

* 呈現分支
* 清單渲染
* UI 狀態切換

---

## 三、Less Zero 架構原則

Less Zero 的核心不是「零狀態」，而是：

> **狀態存在，但必須是顯性、可追蹤、可替換的**

### 3.1 狀態層級劃分

1. View State（Component Signals）
2. Feature State（Service + Signals）
3. Cross-Feature State（僅在必要時）

禁止：

* 全域隱性 singleton 狀態
* 在 constructor 中隱性啟動資料流

### 3.2 資料流方向

* 單向資料流（Data → View）
* 所有狀態變更必須有明確入口

---

## 四、SSR（Server-Side Rendering）規範

### 4.1 SSR 定位

SSR 是：

* SEO
* 首屏效能
* 行為一致性

SSR 不是：

* 用來偷放業務邏輯
* 用來隱藏副作用

### 4.2 SSR 資料取得原則

* Server-only 資料必須在 Resolver 或 Server Layer
* Client-only 行為不得污染 SSR pipeline
* 使用 TransferState 明確標示資料邊界

### 4.3 禁止事項

* SSR 階段使用瀏覽器 API
* SSR 與 CSR 行為不一致

---

## 五、Routing 與 Feature 邊界

### 5.1 Routing 原則

* Route = Feature 邊界
* 每個 Route 擁有自己的資料取得策略
* 禁止跨 Route 存取內部狀態

### 5.2 Lazy Loading

* Feature 預設 Lazy
* 僅核心殼層為 Eager

---

## 六、與 Next.js 類框架遷移時的約束

### 6.1 行為優先順序

1. 使用者可觀察行為
2. SSR 輸出 HTML
3. SEO / metadata
4. 互動時序

### 6.2 明確不做的事情

* 不 1:1 模仿 Next API
* 不引入 RSC 類隱性魔法
* 不為了像而破壞 Angular 架構

---

## 七、允許與禁止清單（總表）

### 允許

* Signals 作為主要狀態模型
* 明確的資料取得層
* Router Resolver 承擔 SSR 資料準備

### 禁止

* 隱性副作用
* Template 中的邏輯計算
* 無文件的狀態共享

---

## 八、實作前檢查清單（Gate）

在任何功能實作前，必須確認：

* 是否清楚此功能的 SSR 行為
* 是否明確資料生命週期
* 是否符合 Less Zero 狀態原則
* 是否未突破 Feature 邊界

未通過任一項，不得實作。

---

## 九、結語

此規範的目的不是限制速度，而是：

> **避免專案在成長後，因隱性行為而失控**

任何偏離本文件的設計，都必須被明確記錄並審核。
